<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="utf-8">
    <title>Biên bản nghiệm thu</title>
    <meta name="csrf-token" content="MHMXdIG4tBlzbq7sMs8y0wjq43Dtbf8PaMgnKDS3">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="shortcut icon" href="https://rndwows.github.io/hcnswows/logowows.jpg" type="image/x-icon">
    <!-- jQuery library -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />

    <style>
        body {
            background: rgb(204, 204, 204);
            font-family: "Times New Roman", Times, serif;
        }

        .fixed-button {
            position: fixed;
            bottom: 20px;
            /* Điều chỉnh vị trí từ dưới lên, bạn có thể thay đổi giá trị này */
            right: 20px;
            /* Điều chỉnh vị trí từ phải sang, bạn có thể thay đổi giá trị này */
            width: 100%;
            max-width: 200px;
            /* Điều chỉnh chiều rộng tối đa của button */
        }

        page {
            background: white;
            display: block;
            margin: 0 auto;
            margin-bottom: 0.5cm;
            box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
        }

        page[size="A4"][layout="landscape"] {
            width: 29.7cm;
            height: 100%;

        }


        .table {
            table-layout: fixed;
            width: 100%;
        }

        .col-stt {
            width: 5%;
        }

        .col-ten-sp {
            width: 10%;
        }

        .col-quy-cach {
            width: 40%;
        }

        .col-dvt {
            width: 6%;
        }

        .col-so-luong {
            width: 5%;
        }

        .col-link {
            width: 10%;
        }

        .col-thoi-gian {
            width: 16%;
        }

        .col-nghiem-thu {
            width: 8%;
        }

        .table th,
        .table td {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: normal;
        }




        @media print {

            .table th,
            .table td {
                overflow: visible;
                white-space: normal;
                word-wrap: break-word;
            }

            .link-bangiao,
            .nguoi-tiepnhan {
                display: none;
            }

            .print-only {
                display: inline;
            }

            body,
            #content {
                margin: 0;
                box-shadow: 0;
                font-size: 18px !important;
            }

            h5 {
                font-size: 24px
            }

            .date-input {
                display: none;
            }

            .no-print {
                display: none !important;
            }

            .big-title {
                font-size: 18px !important;
            }

            .total-pay {
                font-size: 15px !important;
            }

            @page {
                size: auto;
            }

            #content-split {
                margin-top: 40px;
                position: absolute;
                top: 50%;
                width: 920px;
            }

            .height_hr {
                border-top: 3px dashed black;
                width: 100%;
                position: absolute;
                top: 49%;
            }

            #content-split .div-logo {
                position: relative;
                top: -10px;
                left: 10px;
            }

            #sequenceNumber {
                display: none;
            }


            .participant-row.empty {
                display: none !important;
            }


            .participant-table input[type="text"] {
                border: none;
                border-bottom: none !important;
                /* Đảm bảo không có gạch chân */
                text-align: left;
                padding-left: 0;
                background: transparent;
                /* Loại bỏ background */
                -webkit-box-shadow: none;
                /* Loại bỏ box-shadow trên webkit browsers */
                box-shadow: none;
                /* Loại bỏ box-shadow */
            }

            .participant-table td {
                text-align: left;
            }

            .company-header {
                text-align: left;
                font-weight: bold;
            }

            .print-align-left {
                text-align: left !important;
            }

            /* Ẩn outline khi focus */
            .participant-table input[type="text"]:focus {
                outline: none;
                border: none;
                -webkit-box-shadow: none;
                box-shadow: none;
            }

            .signature-input {
                display: none !important;
            }

            .print-only {
                display: block !important;
            }


        }

        #content {
            font-size: 13.5px;

        }


        .center {
            text-align: center;
        }

        .right {
            text-align: right;
        }

        .bold {
            font-weight: bold;
        }

        .big-title {
            font-size: 15px;
        }

        #fixed-panel,
        #fixed-show-user,
        #fixed-show-reason {
            font-size: 13px;
        }


        #content {
            padding: 40px 40px;
        }

        #select-setup-print {
            position: relative;
            top: -2px;
            background-color: #17a2b8;
            color: white;
        }

        #setup-print {
            position: fixed;
            top: 480px;
            left: 30px;
            width: 150px;
            height: 54px;
            background-color: #ffffff;
            padding: 10px;
            border-radius: 5px;
            /*font-size: 13px;*/
            box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
        }


        .heigth-90px {
            height: 90px !important;
        }

        #page {
            margin-top: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .center-content {
            text-align: center;
            vertical-align: middle;
        }

        .big-title {
            text-transform: uppercase;
            font-weight: bold;
            /*font-size: 15px;*/
            padding-bottom: 5px;
        }

        hr {
            margin-top: 5px;
            margin-bottom: 5px;
        }

        .bold {
            font-weight: bold;
        }

        .table-center th {
            text-align: center;
            vertical-align: middle;
        }

        .info_student {
            margin-top: 10px;
            text-align: justify;
        }

        .info_contract {
            margin-bottom: 5px !important
        }

        .preserve-format {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .table thead th {
            vertical-align: middle;
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        d .table th,
        .table td {
            padding: 0.75rem;
            vertical-align: top;
            border-top: 1px solid #dee2e6;
        }

        .center {
            text-align: center;
        }

        .table-bordered {
            border: 1px solid #dee2e6;
        }


        .form-control.link-bangiao,
        .form-control.nguoi-tiepnhan {
            width: 100%;
            padding: 0.25rem 0.5rem;
            /* Giảm padding */
            font-size: 0.875rem;
            /* Giảm kích thước font */
            line-height: 1.3;
            /* Giảm line-height */
            color: #495057;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            border-radius: 0.2rem;
            /* Giảm border-radius nếu cần */
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        /* Nếu bạn muốn giảm kích thước tổng thể của input */
        .table td {
            padding: 0.4rem;
            /* Giảm padding của ô td */
        }

        @media screen {
            .print-only {
                display: none;
            }

            .signature-input {
                display: block;
            }
        }

        .signature-input {
            font-weight: bold;
            padding: 5px;
            margin: 0;
            width: 100%;
        }

        .signature-input:focus {
            outline: none;
            border-bottom: 2px solid #555;
        }


        @media only screen and (max-width: 1024px) {
            #fixed-panel {
                display: none !important;
            }

            #list_option_print {
                display: none !important;
            }
        }

        @media screen and (max-width: 600px) {
            .table-responsive {
                overflow-x: auto;
            }
        }



        .participants-container {
            display: flex;
        }


        .participant-table {
            width: 100%;
            border-collapse: collapse;
        }

        .participant-table th,
        .participant-table td {
            padding: 5px;
            border: none;
            /* Loại bỏ viền của các ô */
        }

        .company-header {
            font-weight: bold;
            text-align: left;
        }

        .participant-table input[type="text"] {
            border: none;
            border-bottom: 1px solid #ccc;
            /* Thêm đường gạch chân nhẹ */
            outline: none;
            padding: 2px;
            width: 70%;
        }

        .participant-table input[type="text"]:focus {
            border-bottom: 2px solid #555;
            /* Đường gạch chân đậm hơn khi focus */
        }


        .participant-row {
            transition: opacity 0.3s ease;
        }

        .participant-row[style*="display: none"] {
            opacity: 0;
        }
    </style>

</head>

<body>
    <button onclick="print()" class="btn btn-info fixed-button" style="width: 100%"><i class="fa fa-print"></i> <span
            class="language_print"></span></button>
    <page size="A4" id="page" layout="landscape">
        <div id="content">
            <div class="content_page1">
                <table style="width: 100%;">
                    <tr>
                        <th rowspan="4"> <img src="https://rndwows.github.io/hcnswows/logowows.jpg"
                                style="width: 100px; margin: -30px"></th>
                        <th style="width: 60%;" rowspan="4" class="center">
                            <h4 class=" bold">CÔNG TY CỔ PHẦN TẬP ĐOÀN WOWS</h4>

                        </th>
                        <td style="font-size: 12px;">Mã hiệu: </th>
                        <td style="font-size: 12px;"><span>WS-KD-QT02/BM05</span></th>
                    </tr>
                    <tr>
                        <td style="font-size: 12px;"> Lần ban hành: 01</td>
                        <td style="font-size: 12px;">Hiệu chỉnh lần: 00</td>
                    </tr>
                    <tr>
                        <td style="font-size: 12px;">Ngày ban hành: <span>01/07/2024</td>
                        <td style="font-size: 12px;">Ngày hiệu chỉnh: <span>00</td>
                    </tr>
                    <tr>
                        <td style="font-size: 12px;">Số:</td>
                        <td style="font-size: 12px;">BNT-<span id="Tvt"></span>-<span id="currentDate"></span>-<input
                                type="text" id="sequenceNumber" class="no-print"
                                style="width: 40px; border: none; border-bottom: 1px solid black;"><span
                                id="sequenceNumberDisplay"></span>
                        </td>
                    </tr>
                </table>


                <div style="clear: both"></div>
                <br>
                <h2 style="text-align: center;" class="bold"><span>BIÊN BẢN NGHIỆM THU</span></h2>
                <i>Hôm nay, &emsp; Ngày
                    <input type="text" id="day" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    Tháng
                    <input type="text" id="month" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    Năm
                    <input type="text" id="year" class="date-input"
                        style="width: 50px; border: none; border-bottom: 1px solid black;">
                </i>
                <br>
                <i>Tại văn phòng công ty: </i><span id="companyName"></span>
                <br>
                <i>Địa chỉ: </i><span id="companyAddress"></span>
                <br>
                <div class="bold">1. Thời gian nghiệm thu: </div>
                <i>Bắt đầu: &emsp;
                    Giờ
                    <input type="text" id="hour" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    Phút
                    <input type="text" id="phut" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    Ngày
                    <input type="text" id="day" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    Tháng
                    <input type="text" id="month" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    Năm
                    <input type="text" id="year" class="date-input"
                        style="width: 50px; border: none; border-bottom: 1px solid black;">
                </i> <br>
                <i>kết thúc: &emsp;
                    Giờ
                    <input type="text" id="hour" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    Phút
                    <input type="text" id="phut" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    Ngày
                    <input type="text" id="day" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    Tháng
                    <input type="text" id="month" class="date-input"
                        style="width: 30px; border: none; border-bottom: 1px solid black;">
                    Năm
                    <input type="text" id="year" class="date-input"
                        style="width: 50px; border: none; border-bottom: 1px solid black;">
                </i>
                <br>
                <div class="bold">2. Hội đồng nghiệm thu bao gồm:</div>
                <div style="display: flex; justify-content: space-between;">

                    <div class="participants-container">
                        <div class="column">
                            <table class="participant-table">
                                <tr>
                                    <th colspan="6">Đại diện chủ đầu tư:</th>
                                </tr>
                                <tr class="participant-row">
                                    <td colspan="2">1. Ông/Bà: <input type="text" id="companyA-person1"
                                            class="participant-input"></td>
                                    <td colspan="2">Chức vụ: <input type="text" id="companyA-position1"
                                            class="participant-input"></td>
                                </tr>
                                <tr class="participant-row">
                                    <td colspan="2">2. Ông/Bà: <input type="text" id="companyA-person1"
                                            class="participant-input"></td>
                                    <td colspan="2">Chức vụ: <input type="text" id="companyA-position1"
                                            class="participant-input"></td>
                                </tr>
                                <tr class="participant-row">
                                    <td colspan="2">3. Ông/Bà: <input type="text" id="companyA-person1"
                                            class="participant-input"></td>
                                    <td colspan="2">Chức vụ: <input type="text" id="companyA-position1"
                                            class="participant-input"></td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <div class="participants-container">
                        <div class="column">
                            <table class="participant-table">
                                <tr>
                                    <th colspan="6">Đại diện đơn vị cung cấp: Công ty Cổ Phần Tập đoàn WOWS</th>
                                </tr>
                                <tr class="participant-row">
                                    <td colspan="2">1. Ông/Bà: <input type="text" id="companyA-person1"
                                            class="participant-input"></td>
                                    <td colspan="2">Chức vụ: <input type="text" id="companyA-position1"
                                            class="participant-input"></td>
                                </tr>
                                <tr class="participant-row">
                                    <td colspan="2">2. Ông/Bà: <input type="text" id="companyA-person1"
                                            class="participant-input"></td>
                                    <td colspan="2">Chức vụ: <input type="text" id="companyA-position1"
                                            class="participant-input"></td>
                                </tr>
                                <tr class="participant-row">
                                    <td colspan="2">3. Ông/Bà: <input type="text" id="companyA-person1"
                                            class="participant-input"></td>
                                    <td colspan="2">Chức vụ: <input type="text" id="companyA-position1"
                                            class="participant-input"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="bold">3. Hội đồng nghiệm thu đã tiến hành:</div>
                <div>Xem xét hồ sơ tài liệu sau:</div>
                <div>Báo giá/hợp đồng số: <span id="id" class="bold"></span></div>
                <p class="bold">Kiểm tra thực tế thông tin tính năng của sản phẩm dịch vụ theo danh mục:</p>

                <table class="table table-bordered">
                    <thead class="center-content">
                        <tr>
                            <th class="center col-stt" rowspan="2">STT</th>
                            <th class="col-ten-sp" rowspan="2">Tên sản phẩm</th>
                            <th class="col-quy-cach" rowspan="2">Mô tả sản phẩm</th>
                            <th class="col-dvt" rowspan="2">Đơn vị tính</th>
                            <th class="col-so-luong" rowspan="2">Số lượng</th>
                            <th class="col-link" rowspan="2">Link bàn giao (Nếu có)</th>
                            <th class="col-thoi-gian" colspan="2">Thời gian thử</th>
                            <th class="col-nghiem-thu" rowspan="2">Kết quả nghiệm thu</th>
                        </tr>
                        <tr>
                            <th>Bắt đầu</th>
                            <th>Hoàn thành</th>
                        </tr>
                    </thead>
                    <tbody id="orderDetailsBody">
                        <!-- Dữ liệu sẽ được điền vào đây bằng JavaScript -->
                    </tbody>

                </table>

                <div class="bold">4. Những sửa đổi lớn so với yêu cầu ban đầu:</div>
                <i>
                    <input type="text" id="ghichu" class="date-input"
                        style="width: 100%; border: none; border-bottom: 1px solid black;">
                </i>
                <br>
                <div class="bold">5. Kiến nghị:</div>
                <i>
                    <input type="text" id="kiennghi" class="date-input"
                        style="width: 100%; border: none; border-bottom: 1px solid black;">
                </i>
                <br>
                <div class="bold">6. Kết luận:</div>
                <i>
                    <input type="text" id="ketluan" class="date-input"
                        style="width: 100%; border: none; border-bottom: 1px solid black;">
                </i> <br>
                <i>Xác nhận của các thành phần tham gia hội đồng nghiệm thu :</i>



                <div id="footerInfo" class="mt-4">
                    <!-- Thông tin cuối sẽ được thêm vào đây -->
                </div>
            </div>
        </div>
    </page>


    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/printThis/1.15.0/printThis.min.js"
        integrity="sha512-d5Jr3NflEZmFDdFHZtxeJtBzk0eB+kkRXWFQqEc1EKmolXjHm2IKCA7kTvXBNjIYzjXfD5XzIjaaErpkZHCkBg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.centeronline.edu.vn/js/customer.js" type="text/javascript"></script>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbzbbhvgeKfcvQpwmbZtDwW2pbBtX0uX9HJ-ALRPH9YnpacpBjIMMwE5R3NMO6I6yy_GuQ/exec';

        // Biến toàn cục để lưu trữ dữ liệu
        var BAN_GIAO = {};
        var CT_BANGIAO = [];
        var KHTN = {};
        var DKTT = [];

        function searchContract(soBG) {
            fetch(`${API_URL}?SOBG=${encodeURIComponent(soBG)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        BAN_GIAO = data.ban_giao || {};
                        CT_BANGIAO = data.chitiet_bangiao || [];
                        KHTN = data.khtn || {};
                        DKTT = data.dktt || [];

                        updateUI();
                    } else {
                        console.error('Lỗi:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Đã xảy ra lỗi:', error.message);
                });
        }

        // Tìm phần tử span
        const idSpan = document.getElementById('id');

        // Tạo phần tử input mới
        const input = document.createElement('input');
        input.type = 'text';
        input.value = idSpan.textContent;
        input.style.cssText = `
    border: none; 
    border-bottom: 1px solid #ccc;
    font-weight: bold;
    width: 200px;
    padding: 2px 5px;
`;

        // Ẩn input khi in
        input.classList.add('no-print');

        // Tạo span chỉ hiển thị khi in
        const printSpan = document.createElement('span');
        printSpan.classList.add('print-only');
        printSpan.textContent = idSpan.textContent;

        // Thay thế span gốc bằng cả hai phần tử
        idSpan.innerHTML = ''; // Xóa nội dung span gốc
        idSpan.appendChild(input);
        idSpan.appendChild(printSpan);

        // Cập nhật span in khi input thay đổi
        input.addEventListener('input', function () {
            printSpan.textContent = this.value;
        });

        function updateUI() {
            // Tìm phần tử input và print span trong span id
            const input = document.querySelector('#id input');
            const printSpan = document.querySelector('#id .print-only');

            // Cập nhật giá trị cho cả input và print span
            if (input && printSpan) {
                input.value = BAN_GIAO['Số HĐ'] || '';
                printSpan.textContent = BAN_GIAO['Số HĐ'] || '';
            }

            // Các phần cập nhật khác
            document.getElementById('companyName').textContent = KHTN['TÊN CÔNG TY'] || '';
            document.getElementById('companyAddress').textContent = KHTN['ĐỊA CHỈ'] || '';
            document.getElementById('Tvt').textContent = KHTN['TÊN VIẾT TẮT'] || '';

            updateProductTable();
            addInputListeners();
            updateFooter();
        }

        function updateProductTable() {
            const tableBody = document.getElementById('orderDetailsBody');
            tableBody.innerHTML = CT_BANGIAO.map((item, index) => `
        <tr>
            <td class="center">${index + 1}</td>
            <td>${item['Ten_hang_hoa/dich_vu'] || ''}</td>
            <td class="preserve-format">${item['Chi_tiet_hang_hoa'] || ''}</td>
            <td>${item['DVT'] || ''}</td>
            <td class="center">${item['So_luong'] || ''}</td>
            <td class="preserve-format">${item['Link_bangiao'] || ''}</td>
            <td>
                <input type="text" class="form-control nguoi-tiepnhan" placeholder="Từ ngày" value="${item['Nguoi_tiep_nhan'] || ''}">
                <span class="print-only"></span>
            </td>
            <td>
                <input type="text" class="form-control nguoi-tiepnhan" placeholder="Đến ngày" value="${item['Nguoi_tiep_nhan'] || ''}">
                <span class="print-only"></span>
            </td>
             <td class="center">
            <label class="checkbox-container no-print">
                <input type="checkbox" class="form-control ket-quanghiemthu" ${item['Ket_qua_nghiem_thu'] === 'Đạt' ? 'checked' : ''}>
                <span class="checkmark"></span>
            </label>
            <span class="print-only ket-qua-text">${item['Ket_qua_nghiem_thu'] || ''}</span>
        </td>
        </tr>
    `).join('');

            addInputListeners();
        }


        document.getElementById('orderDetailsBody').addEventListener('input', function (event) {
            if (event.target.classList.contains('link-bangiao') || event.target.classList.contains('nguoi-tiepnhan')) {
                const printSpan = event.target.nextElementSibling;
                printSpan.textContent = event.target.value;
            }
        });


        const observer = new MutationObserver(function (mutations) {
            mutations.forEach(function (mutation) {
                if (mutation.type === 'childList') {
                    addInputListeners();
                }
            });
        });

        observer.observe(document.getElementById('orderDetailsBody'), { childList: true, subtree: true });



        function addInputListeners() {
            const inputs = document.querySelectorAll('.link-bangiao, .nguoi-tiepnhan');
            inputs.forEach(input => {
                const printSpan = input.nextElementSibling;
                printSpan.textContent = input.value; // Cập nhật ngay lập tức

                input.addEventListener('input', function () {
                    printSpan.textContent = this.value;
                });
            });

            const checkboxes = document.querySelectorAll('.ket-quanghiemthu');
            checkboxes.forEach(checkbox => {
                const printSpan = checkbox.closest('td').querySelector('.ket-qua-text');
                printSpan.textContent = checkbox.checked ? 'Đạt' : 'Không đạt';

                checkbox.addEventListener('change', function () {
                    printSpan.textContent = this.checked ? 'Đạt' : 'Không đạt';
                });
            });

        }
        // Gọi hàm này sau khi tạo bảng hoặc khi trang đã load xong
        document.addEventListener('DOMContentLoaded', addInputListeners);



        function updatePODetail() {
            const rows = document.querySelectorAll('#orderDetailsBody tr');
            rows.forEach((row, index) => {
                CT_BANGIAO[index]['Nguoi_tiep_nhan'] = row.querySelector('.nguoi-tiepnhan').value;
                CT_BANGIAO[index]['Ket_qua_nghiem_thu'] = row.querySelector('.ket-quanghiemthu').checked ? 'Đạt' : 'Không đạt';
            });
        }


        function prepareForPrinting() {
            updatePODetail();
            const inputs = document.querySelectorAll('.link-bangiao, .nguoi-tiepnhan');
            inputs.forEach(input => {
                input.style.display = 'none';
            });

            const rows = document.querySelectorAll('.participant-row');
            rows.forEach(row => {
                const inputs = row.querySelectorAll('input[type="text"]');
                const isEmpty = Array.from(inputs).every(input => !input.value.trim());
                if (isEmpty) {
                    row.classList.add('empty');
                } else {
                    row.classList.remove('empty');
                }
            });
        }



        function updateFooter() {
            const footerInfo = document.getElementById('footerInfo');
            let footerHTML = `
    <table style="width: 100%; text-align: center;">
        <tbody>
            <tr>
                <td style="width: 50%;"><span class="bold">Đại diện đơn vị cung cấp</span></td>
                <td style="width: 50%;"><span class="bold">Đại diện chủ đầu tư</span></td>
            </tr>
            <tr>
                <td style="width: 50%;"><span class="bold">CÔNG TY CỔ PHẦN TẬP ĐOÀN WOWS</span></td>
                <td style="width: 50%;"><span class="bold" id="benb1">${KHTN['TÊN CÔNG TY'] || 'CÔNG TY TNHH MỘT THÀNH VIÊN ADL PAPERPACKAGING'}</span></td>
            </tr>
            <tr>
                <td>(Ký, đóng dấu và ghi rõ họ tên) <br> <br> <br> <br> <br> <br> </td>
                <td>(Ký, đóng dấu và ghi rõ họ tên) <br> <br> <br> <br> <br> <br> </td>
            </tr>
            <tr>
                <td>
                    <input type="text" class="bold signature-input no-print" value="BÀ ĐỖ THỊ KIM THỦY" 
                           style="text-align: center; width: 100%; border: none; border-bottom: 1px solid #ccc;">
                    <p class="bold print-only signature-text">BÀ ĐỖ THỊ KIM THỦY</p>
                </td>
                <td>
                    <input type="text" class="bold signature-input no-print" 
                           value="${KHTN['NGƯỜI LIÊN HỆ'] || 'Ông Bà'}" 
                           style="text-align: center; width: 100%; border: none; border-bottom: 1px solid #ccc; text-transform: uppercase;">
                    <p style="text-transform: uppercase;" class="bold print-only signature-text">
                        ${KHTN['NGƯỜI LIÊN HỆ'] || 'Ông Bà'}
                    </p>
                </td>
            </tr>
            <tr>
                <td>
                    <i class="">Ngày ký: .............................</i>
                </td>
                <td>
                    <i class="">Ngày ký: .............................</i>
                </td>
            </tr>
        </tbody>
    </table>
    `;

            footerInfo.innerHTML = footerHTML;

            // Thêm event listeners cho các input
            const signatureInputs = document.querySelectorAll('.signature-input');
            signatureInputs.forEach(input => {
                const signatureText = input.nextElementSibling;
                input.addEventListener('input', function () {
                    signatureText.textContent = this.value;
                });
            });
        }

        // (Giữ nguyên các hàm hỗ trợ như formatCurrency, formatDate, numberToWords)

        document.addEventListener('DOMContentLoaded', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const soBG = urlParams.get('SOBG');
            if (soBG) {
                searchContract(soBG);
            } else {
                console.error('Vui lòng cung cấp số hợp đồng trong URL (ví dụ: ?SOBG=HD001)');
            }


            updateProductTable();
            addInputListeners();
        });

        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return dateString;
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = String(date.getFullYear());
            return `${day}/${month}/${year}`;
        }
        function formatCurrency(value) {
            if (!value) return '';
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(value);
        }

        function print() {
            prepareForPrinting();
            $('#content').printThis({
                debug: false,
                importCSS: true,
                importStyle: true,
                printContainer: true,
                pageTitle: "",
                removeInline: false,
                removeInlineSelector: "*",
                printDelay: 333,
                header: null,
                footer: null,
                base: false,
                formValues: true,
                canvas: false,
                removeScripts: false,
                copyTagClasses: false,
                beforePrintEvent: null,
                beforePrint: null,
                afterPrint: function () {
                    // Hiển thị lại tất cả các input sau khi in
                    const inputs = document.querySelectorAll('.link-bangiao, .nguoi-tiepnhan');
                    inputs.forEach(input => {
                        input.style.display = 'inline-block';
                    });
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Lấy ngày hôm nay
            var today = new Date();
            var day = today.getDate();
            var month = today.getMonth() + 1; // Tháng bắt đầu từ 0
            var year = today.getFullYear();

            // Điền ngày hôm nay vào các ô input
            document.getElementById('day').value = day;
            document.getElementById('month').value = month;
            document.getElementById('year').value = year;

            // Tạo và cập nhật các span
            var inputs = document.querySelectorAll('.date-input');
            inputs.forEach(function (input) {
                var span = document.createElement('span');
                span.textContent = input.value;
                input.parentNode.insertBefore(span, input.nextSibling);

                input.addEventListener('input', function () {
                    span.textContent = this.value;
                });
            });
        });

        document.addEventListener('DOMContentLoaded', function () {
            // Tìm phần tử span
            const idSpan = document.getElementById('id');

            // Tạo phần tử input mới
            const input = document.createElement('input');
            input.type = 'text';
            input.value = idSpan.textContent;
            input.style.cssText = `
        border: none; 
        border-bottom: 1px solid #ccc;
        font-weight: bold;
        width: 200px;
        padding: 2px 5px;
    `;

            // Ẩn input khi in
            input.classList.add('no-print');

            // Tạo span chỉ hiển thị khi in
            const printSpan = document.createElement('span');
            printSpan.classList.add('print-only');
            printSpan.textContent = idSpan.textContent;

            // Thay thế span gốc bằng cả hai phần tử
            idSpan.innerHTML = '';
            idSpan.appendChild(input);
            idSpan.appendChild(printSpan);

            // Cập nhật span in khi input thay đổi
            input.addEventListener('input', function () {
                printSpan.textContent = this.value;
            });
        });

        document.addEventListener('DOMContentLoaded', function () {
            // Lấy ngày hiện tại
            var today = new Date();
            var day = String(today.getDate()).padStart(2, '0');
            var month = String(today.getMonth() + 1).padStart(2, '0'); // Tháng bắt đầu từ 0

            // Điền ngày và tháng vào span
            var currentDateSpan = document.getElementById('currentDate');
            currentDateSpan.textContent = day + '.' + month;

            // Xử lý số thứ tự
            var sequenceInput = document.getElementById('sequenceNumber');
            var sequenceDisplay = document.getElementById('sequenceNumberDisplay');

            sequenceInput.addEventListener('input', function () {
                var value = this.value.padStart(3, '0');
                sequenceDisplay.textContent = value;
            });
        });




    </script>
</body>

</html>